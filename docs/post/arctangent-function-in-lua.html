<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="math.atan and math.atan2 in Lua. Explanation of arctangent function and why it is inconsistent in different versions of Lua. ">
<meta name="keywords" content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal">
<meta name="author" content="Dmitri Smirnov">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.whoop.ee/luablog//post/arctangent-function-in-lua.html">
<meta property="og:image" content="https://www.whoop.ee/luablog//assets/img/lua-language.gif">
<meta http-equiv="Content-Security-Policy" content="script-src 'self'">
<meta http-equiv="Content-Security-Policy" content="object-src 'none'">
<title>Arctangent function in Lua &mdash; Whoopee</title>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" href="/assets/css/styles.min.css?1718291237">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml">
</head>
  <body>
      <header>
    <a href="/" class="logo">Whoopee</a>
    <nav class="mainmenu">
      <a href="/about.html">About</a>
      <a href="/feed.xml">RSS</a>
    </nav>
  </header>
    <main>
      <a href="/"><em>&larr; Back to the index page</em></a>
      <article>
        <h1>Arctangent function in Lua</h1>
        <time datetime="2024-05-10">
          May 10, 2024
        </time>
        <!-- Description: math.atan and math.atan2 in Lua. Explanation of arctangent function and why it is inconsistent in different versions of Lua. -->


<p>Simple trigonometric function arctangent is very confusing in Lua.
In Lua version 5 this function changed many times. I found such variants:</p>
<ul>
<li><code>math.atan(x)</code>: 5.1, 5.2</li>
<li><code>math.atan2(x, y)</code>: 5.1, 5.2</li>
<li><code>math.atan(y [, x])</code>: 5.3, 5.4</li>
</ul>
<p>It is very confusing. Let&rsquo;s try to figure out what is what.</p>
<h2 id="what-is-the-trigonometric-arctangent-function">What is the trigonometric arctangent function</h2>
<p>Time to remind a school math class.</p>
<p>Calculating and finding angles is a very common task for game developers.
Arctagnent allows to find the angle between a point and X-axis with ease.</p>
<p><img alt="Figure 01. Arctangent angles with arctangent" src="/assets/img/atan01.svg" /></p>
<p>We know two points: <em>A(10, 10) and </em>O(0, 0)* is center. If 2 points are known, 
then we can make a line between them. General equation of a line
(linear function):</p>
<div class="codehilite"><pre><span></span><code>y = kx + c*
</code></pre></div>

<p>Where:</p>
<ul>
<li><strong><em>y</em></strong> is the value on the Y-axis.</li>
<li><strong><em>k</em></strong> is the tangent of the angle between the line and the X-axis
  (<strong><em>k = tan(α)</em></strong>). </li>
<li><strong><em>x</em></strong> value on the X-axis.</li>
<li><strong><em>c</em></strong> offset by the Y-axis.</li>
</ul>
<p>Consider point <strong><em>A(10, 10)</em></strong>:</p>
<div class="codehilite"><pre><span></span><code>y = tan(α) * x
tan(k) = y/x
α = arctan(y/x)
α = arctan(10/10) = arctan(1)
α ≈ 0.78539 = 45°
</code></pre></div>

<p>Consider point <strong><em>B(5, -10)</em></strong>:</p>
<div class="codehilite"><pre><span></span><code>y = tan(α) * x
tan(k) = y/x
α = arctan(y/x)
α = arctan(-10/5) = arctan(-2)
α ≈ -1.107149 ≈ -63.4349°
</code></pre></div>

<h2 id="lua-function">Lua function</h2>
<p>Lua&rsquo;s built-in <code>math</code> library calculates everything written above for you. But
there are many versions in different Lua versions and which to use.
Usually <code>math.atan()</code> or <code>math.atan2()</code> functions confuse beginners.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Function <code>math.atan2()</code> is deprecated and might not work in your
environment.</p>
</div>
<p>The general rule is to use <code>math.atan()</code> in the form. </p>
<div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">math.atan</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span> <span class="c1">--&gt; 0.78539816339745 radians which equal 45 degrees</span>
</code></pre></div>

<p>This should work with every Lua version.</p>
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>Use <code>math.atan()</code> everywhere possible;</li>
<li><code>math.atan2()</code> is deprecated.</li>
</ul>
<h2 id="bonus-converting-radians-to-degrees-and-vice-versa">Bonus: converting radians to degrees and vice-versa</h2>
<p>Function to convert radians to degrees:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">rad2deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="nb">math.pi</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<p>Function to convert degrees to radians:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">deg2rad</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="nb">math.pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h2 id="links">Links</h2>
<ul>
<li><a href="https://www.lua.org/manual/5.4/manual.html#pdf-math.atan">Lua manual: math.atan()</a></li>
<li><a href="https://en.wikipedia.org/wiki/Inverse_trigonometric_functions">Wikipedia: Inverse trigonometric functions</a></li>
<li><a href="https://www.omnicalculator.com/math/arctan">Another good explanation</a></li>
</ul>
        <h2>Feedback</h2>
<p>
For feedback, please check the <a href="/about.html#contacts">contacts</a> section.
Before writing, please specify where you came from and who you are. Sometimes spammers go insane.
Thank you in advance for your understanding.
</p>
      </article>
      <a href="/"><em>&larr; Back to the index page</em></a>
    </main>
      <footer>
    <hr>
    <p>
      &copy; 2022&mdash;2024 <a href="/about.html">xdknight</a>
      Powered by <a href="https://github.com/hmngwy/jenny">Jenny</a> shell
      blog engine. <a href="https://github.com/dknight/whoopee">Source code</a>
    </p>
    <p>
      Any images on this website may be used, copied and redistributed under the
      <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 Deed</a> license.
    </p>
    <p>
      Any code on this website may be used, copied and redistributed under the
      <a href="https://opensource.org/license/MIT">MIT</a> license.
    </p>
    <p>
      This website <strong>does not</strong> use cookies or any tracking techniques either.
      Also, this page is fully accessible, responsive, and readable on any
      device without a single line of <abbr title="Tool of evil">JavaScript</abbr>.
    </p>
  </footer>
  </body>
</html>
