<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="An article provides a detailed explanation of iterators in Lua, including their purpose, functionality, and usage. It also includes practical examples to demonstrate how iterators work and how they can be implemented effectively in Lua programs. " name=description><meta content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal" name=keywords><meta content="Dmitri Smirnov" name=author><meta content=website property=og:type><meta content=https://www.whoop.ee/post/iterators.html property=og:url><meta content=https://www.whoop.ee/assets/img/whoopee-logo-black.png property=og:image><meta content="script-src 'self'" http-equiv=Content-Security-Policy><meta content="object-src 'none'" http-equiv=Content-Security-Policy><title>Iterators — Whoopee</title><link as=font href=/assets/fonts/Perfect_DOS_VGA_437.woff2 rel=preload><link href=/favicon.ico rel=icon type=image/x-icon><link href=/assets/css/styles.min.css rel=stylesheet><link title="RSS Feed" href=/feed.xml rel=alternate type=application/rss+xml><link href=https://www.whoop.ee/post/iterators.html rel=canonical><body><header><a href=/><img alt=Whoopee class=logo height=172 src=/assets/img/whoopee-logo.png width=200></a><nav class=mainmenu><a href=/me/>About</a><a href=/feed.xml>RSS</a></nav></header><main><a href=/>← Back to the index page</a><article><h1>Iterators</h1><time datetime=2025-02-24> February 24, 2025 </time><p>An iterator is any structure that enables traversal through the elements of a collection (table). In Lua, iterators are usually represented as functions that return the next element from the collection each time they are called. There are built-in iterators: <a href=https://www.lua.org/manual/5.4/manual.html#pdf-pairs><code>pairs</code></a> and <a href=https://www.lua.org/manual/5.4/manual.html#pdf-ipairs><code>ipairs</code></a>. Under the hood <code>pairs</code> and <code>ipairs</code> iterators use <a href=https://www.lua.org/manual/5.4/manual.html#pdf-next><code>next</code></a> function.<h2 id=generic-for-loop>Generic for-loop<a title="Permanent link" class=headerlink href=#generic-for-loop>#</a></h2><div class=codehilite><pre><span></span><code>for &LTvar-list> in &LTexpr-list> do
    &LTbody>
end
</code></pre></div><p>Where:<ul><li><strong>var-list</strong>: a comma-separated list of variable names available in the body;<li><strong>exp-list</strong>: a comma-separated list of expressions.</ul><h3 id=simple-iterator>Simple iterator<a title="Permanent link" class=headerlink href=#simple-iterator>#</a></h3><div class=codehilite><pre><span></span><code><span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=nb>ipairs</span><span class=p>(</span><span class=n>list</span><span class=p>)</span> <span class=kr>do</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
<span class=kr>end</span>
</code></pre></div><p>Can be rewritten without <code>pairs</code> or <code>iparis</code> iterator.<div class=codehilite><pre><span></span><code><span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=nb>next</span><span class=p>,</span> <span class=n>list</span> <span class=kr>do</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
<span class=kr>end</span>
</code></pre></div><h2 id=stateful-iterator>Stateful iterator<a title="Permanent link" class=headerlink href=#stateful-iterator>#</a></h2><p>Iterator that stores its state in itself (variable <code>i</code>). This example has one drawback; it creates the closure (function) with each call at the cost of memory and CPU time. Notice that state can be stored not only in a single variable but also in <code>table</code> if the more complex state is required.<div class="admonition tip"><p class=admonition-title>Tip<p>Read more about <a href=https://www.lua.org/pil/7.4.html>Iterators with Complex State</a> in the PIL book.<p>I would prefer to design software using <a href=#stateless-iterator>stateless iterators</a> or <a href=#stateless-iterator>true iterators</a></div><div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=n>list</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span> <span class=p>}</span>

<span class=kd>local</span> <span class=kr>function</span> <span class=nf>iterator10</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
    <span class=kd>local</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=kr>return</span> <span class=kr>function</span><span class=p>()</span>
        <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=kr>if</span> <span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=kr>then</span>
            <span class=kr>return</span> <span class=n>i</span><span class=p>,</span> <span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=mi>10</span>
        <span class=kr>end</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=kr>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>x</span> <span class=kr>in</span> <span class=n>iterator10</span><span class=p>(</span><span class=n>list</span><span class=p>)</span> <span class=kr>do</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
<span class=kr>end</span>
</code></pre></div><h2 id=stateless-iterator>Stateless iterator<a title="Permanent link" class=headerlink href=#stateless-iterator>#</a></h2><p>It is obvious from the name that this is the iterator that does not store its state. If possible, the stateless iterators are more preferable if performance matters.<div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=kr>function</span> <span class=nf>iter</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
    <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
    <span class=kr>if</span> <span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=n>i</span><span class=p>,</span> <span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=mi>10</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=kd>local</span> <span class=kr>function</span> <span class=nf>iterator10</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
    <span class=kr>return</span> <span class=n>iter</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=mi>0</span>
<span class=kr>end</span>

<span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=n>iterator10</span><span class=p>(</span><span class=n>list</span><span class=p>)</span> <span class=kr>do</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
<span class=kr>end</span>
</code></pre></div><h2 id=true-iterator>True iterator<a title="Permanent link" class=headerlink href=#true-iterator>#</a></h2><p>Actually in Lua, functions do not iterate anything; only the for loop does the iteration. There is another way to create iterators. We can create a function which accepts list as the first argument, and callback function.<div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=kr>function</span> <span class=nf>iterator10</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>callback</span><span class=p>)</span>
    <span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=nb>ipairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
        <span class=n>callback</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=n>iterator10</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=kr>function</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
<span class=kr>end</span><span class=p>)</span>
</code></pre></div><h2 id=coroutines-as-iterators>Coroutines as iterators<a title="Permanent link" class=headerlink href=#coroutines-as-iterators>#</a></h2><p>If you are not familiar with coroutines](/post/understanding-coroutines.html), I would like to recommend looking at my article “<a href=/post/understanding-coroutines.html>Understanding Coroutines in Lua</a>”.<p>For heavy calculations, coroutines can be used as iterators. Here is a very trivial example from above, just iterating the simple list multiplied by <code>10</code>.<div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=kr>function</span> <span class=nf>iter10</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
    <span class=kd>local</span> <span class=n>co</span> <span class=o>=</span> <span class=nb>coroutine.create</span><span class=p>(</span><span class=kr>function</span><span class=p>()</span>
        <span class=kr>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>x</span> <span class=kr>in</span> <span class=nb>ipairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
            <span class=nb>coroutine.yield</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
        <span class=kr>end</span>
    <span class=kr>end</span><span class=p>)</span>
    <span class=kr>return</span> <span class=kr>function</span><span class=p>()</span>
        <span class=kd>local</span> <span class=n>_</span><span class=p>,</span> <span class=n>x</span> <span class=o>=</span> <span class=nb>coroutine.resume</span><span class=p>(</span><span class=n>co</span><span class=p>)</span>
        <span class=kr>if</span> <span class=n>x</span> <span class=kr>then</span>
            <span class=n>x</span> <span class=o>=</span> <span class=n>x</span> <span class=o>*</span> <span class=mi>10</span>
        <span class=kr>end</span>
        <span class=kr>return</span> <span class=n>x</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=kr>for</span> <span class=n>x</span> <span class=kr>in</span> <span class=n>iter10</span><span class=p>(</span><span class=n>list</span><span class=p>)</span> <span class=kr>do</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
<span class=kr>end</span>
</code></pre></div><h2 id=references>References<a title="Permanent link" class=headerlink href=#references>#</a></h2><ul><li><a href=https://www.lua.org/manual/5.4/manual.html#3.3.5>For Statement</a><li><a href=https://www.lua.org/pil/7.html>Programming in Lua: Iterators and the Generic for</a></ul><h2>Feedback</h2><p>For feedback, please check the <a href=/me/>contacts</a> section. Before writing, please specify where you came from and who you are. Sometimes spammers go insane. Thank you in advance for your understanding.</article><a href=/>← Back to the index page</a></main><footer><hr><p>(c) 2022-2025 <a href=/me/>xdknight</a> Powered by <a href=https://github.com/hmngwy/jenny>Jenny</a> shell blog engine.<p>Any images on this website may be used, copied and redistributed under the <a href=https://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a> license.<p>Any code on this website may be used, copied and redistributed under the <a href=https://opensource.org/license/MIT>MIT</a> license.<p>This website does not use cookies or any tracking techniques either. Also, this page is fully accessible, responsive, and readable on any device without a single line of JavaScript.</footer>