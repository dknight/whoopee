<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="This demonstration showcases the process of testing a piece of code across six different versions of the Lua programming language. The goal is to ensure compatibility, identify potential issues, and observe any differences in behavior between versions. By running these tests, we can assess the code’s performance, stability, and necessary adjustments for seamless functionality across all Lua versions. "><meta name="keywords" content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal"><meta name="author" content="Dmitri Smirnov"><meta property="og:type" content="website"><meta property="og:url" content="https://www.whoop.ee/post/testing-multiple-lua-versions-with-laura-and-github-actions.html"><meta property="og:image" content="https://www.whoop.ee/assets/img/dragon-logo.gif"><meta http-equiv="Content-Security-Policy" content="script-src 'self'"><meta http-equiv="Content-Security-Policy" content="object-src 'none'"><title>Testing multiple Lua versions with Laura and GitHub Actions &mdash; Whoopee</title><link rel="preload" href="/assets/fonts/Perfect_DOS_VGA_437.woff2" as="font"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/css/styles.min.css"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml"><link rel="canonical" href="https://www.whoop.ee/post/testing-multiple-lua-versions-with-laura-and-github-actions.html"></head><body><header><a href="/"><img src="/assets/img/dragon-logo.gif" width="200" height="172" alt="Whoopee" class="logo"></a><nav class="mainmenu"><a href="/me/">About</a> <a href="/feed.xml">RSS</a></nav></header><main><a href="/">&larr; Back to the index page</a><article><h1>Testing multiple Lua versions with Laura and GitHub Actions</h1><time datetime="2025-03-09">March 09, 2025</time><p><a href="https://github.com/dknight/laura"><img alt="Laura avatar" src="/assets/img/laura-256.png"></a></p><p>Lua 5 has several major versions, each introducing changes that may cause incompatibilities. Code that works in Lua 5.3 may not function correctly in Lua 5.1 or may behave differently. This is a natural part of the language&rsquo;s evolution, with bug fixes, new features, and occasional removals. If you&rsquo;re developing a library, it&rsquo;s wise to test it across multiple Lua versions. GitHub Actions provides a nearly out-of-the-box solution for this task.</p><p>We will use GitHub Actions containers with Lua and LuaRocks, then install the following rocks: <strong>luacheck</strong> and <strong>laura</strong>.</p><p>Here is the showcase of how to do this.</p><h2 id="preparing-files-for-the-test">Preparing files for the test<a class="headerlink" href="#preparing-files-for-the-test" title="Permanent link">#</a></h2><p>Let&rsquo;s create two files: one for the main code, placed in the src directory, and another for unit tests, located in the test directory. However, the specific directory structure is not mandatory. You change paths later in workflow file.</p><div class="codehilite"><pre><span></span><code><span class="c1">--src/mymath.lua</span>
<span class="kd">local</span> <span class="n">mymath</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">add</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">div</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
    <span class="kr">end</span><span class="p">,</span>
<span class="p">}</span>

<span class="kr">return</span> <span class="n">mymath</span>
</code></pre></div><div class="codehilite"><pre><span></span><code><span class="c1">--test/mymath.test.lua</span>
<span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">mymath</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;src/mymath&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">describe</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">it</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">expect</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;my-math module&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should add two number&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">mymath</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">)).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should subtract two number&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">mymath</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">)).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">38</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should multiply  two number&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">mymath</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">)).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should divide two number&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">mymath</span><span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">)).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should divide by zero and get infinity&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">mymath</span><span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="n">notToBeFinite</span><span class="p">()</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>So structure is very trivial:</p><div class="codehilite"><pre><span></span><code>.
├── src
│   └── mymath.lua
└── test
    └── mymath.test.lua
</code></pre></div><h2 id="setup-github-actions">Setup GitHub Actions<a class="headerlink" href="#setup-github-actions" title="Permanent link">#</a></h2><p>Assumed that you have already created a GitHub repository; if not, here is the <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-new-repository">guide</a> on how to do this.</p><p>Inside your repository, choose actions from the top menu.</p><p><img alt="GitHub Action location in the menu" src="/assets/img/lua-gh-actions-01.png"></p><p>Search for the Simple workflow and select it.</p><p><img alt="GitHub Action Simple workflow" src="/assets/img/lua-gh-actions-02.png"></p><p>The GitHub code editor will be opened. Paste the configuration below into the editor.</p><div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tests</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Put here Lua versions to be tested</span>
<span class="w">        </span><span class="nt">luaVersion</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;5.1&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;5.2&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;5.3&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;5.4&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;luajit-2.1&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;luajit-openresty&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">      </span><span class="nt">TERM</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xterm</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="c1"># Lua and LuaRocks installation</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leafo/gh-actions-lua@v11</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leafo/gh-actions-luarocks@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">luaVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.luaVersion }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;install</span><span class="nv"> </span><span class="s">luacheck&quot;</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">luarocks install luacheck</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;install</span><span class="nv"> </span><span class="s">laura&quot;</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">luarocks install laura</span>

<span class="w">      </span><span class="c1"># Here you change test directory, if is different.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laura test/</span><span class="w"> </span>

<span class="w">      </span><span class="c1"># Here you change source directory, if is different.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">luacheck src/ test/</span>
</code></pre></div><p>After press the button &ldquo;Commit changes&hellip;&rdquo; and set any commit message you like. The new directory with workflow configuration will be committed to the repository <code>.github/workflows/&lt;action&gt;.yml</code>.</p><p><img alt="GitHub Actions commit changes button" src="/assets/img/lua-gh-actions-03.png"></p><p>So we are done, now on every push the code will be tested with versions specified in <code>jobs.test.strategy.matrix.luaVersions</code>, check <a href="https://github.com/dknight/laura-actions-demo">working demo on GitHub</a>.</p><p><img alt="GitHub Actions all builds are passed" src="/assets/img/lua-gh-actions-04.png"></p><h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2><ul><li><a href="https://docs.github.com/en/actions">GitHub Actions documentation</a></li><li><a href="https://docs.github.com/en/actions/about-github-actions/understanding-github-actions">Understanding GitHub Actions</a></li></ul><h2>Feedback</h2><p>For feedback, please check the <a href="/me/">contacts</a> section. Before writing, please specify where you came from and who you are. Sometimes spammers go insane. Thank you in advance for your understanding.</p></article><a href="/">&larr; Back to the index page</a></main><footer><hr><p>(c) 2022-2025 <a href="/me/">xdknight</a> Powered by <a href="https://github.com/hmngwy/jenny">Jenny</a> shell blog engine.</p><p>Any images on this website may be used, copied and redistributed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license.</p><p>Any code on this website may be used, copied and redistributed under the <a href="https://opensource.org/license/MIT">MIT</a> license.</p><p>This website does not use cookies or any tracking techniques either. Also, this page is fully accessible, responsive, and readable on any device without a single line of JavaScript.</p></footer></body></html>