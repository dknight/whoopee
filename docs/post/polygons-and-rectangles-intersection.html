<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Polysec is a framework-agnostic Lua library for detecting intersections and collisions between polygons and rectangles. It provides an efficient algorithm for polygonal intersection detection, making it suitable for the collision handling. While Polysec is independent of any specific framework, examples demonstrating its usage are provided using the Löve2D game development engine. "><meta name="keywords" content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal"><meta name="author" content="Dmitri Smirnov"><meta property="og:type" content="website"><meta property="og:url" content="https://www.whoop.ee/post/polygons-and-rectangles-intersection.html"><meta property="og:image" content="https://www.whoop.ee/assets/img/whoopee-logo.png"><meta http-equiv="Content-Security-Policy" content="script-src 'self'"><meta http-equiv="Content-Security-Policy" content="object-src 'none'"><title>Polygons and rectangles intersection &mdash; Whoopee</title><link rel="preload" href="/assets/fonts/Perfect_DOS_VGA_437.woff2" as="font"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/css/styles.min.css"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml"><link rel="canonical" href="https://www.whoop.ee/post/polygons-and-rectangles-intersection.html"></head><body><header><a href="/"><img src="/assets/img/whoopee-logo.png" width="200" height="172" alt="Whoopee" class="logo"></a><nav class="mainmenu"><a href="/me/">About</a> <a href="/feed.xml">RSS</a></nav></header><main><a href="/">&larr; Back to the index page</a><article><h1>Polygons and rectangles intersection</h1><time datetime="2025-03-19">March 19, 2025</time><div><input type="checkbox" class="toc-toggle" id="toc-toggle"> <label for="toc-toggle">Table of contents</label></div><div class="toc"><ul><li><a href="#polygons-and-rectangles-intersection">Polygons and rectangles intersection</a><ul><li><a href="#polysec-library">Polysec library</a></li><li><a href="#features">Features</a></li><li><a href="#weiler-athethon-algorithm-shortly">Weiler-Athethon algorithm shortly</a><ul><li><a href="#algorithm-preconditions">Algorithm Preconditions</a></li><li><a href="#algorithm-steps">Algorithm Steps</a></li><li><a href="#handling-no-intersection-cases">Handling no intersection cases</a></li></ul></li><li><a href="#usage">Usage</a></li><li><a href="#running-demos">Running demos</a></li><li><a href="#tests">Tests</a></li><li><a href="#api">API</a><ul><li><a href="#types">Types</a></li><li><a href="#modules">Modules</a><ul><li><a href="#point">point</a></li><li><a href="#rectangle">rectangle</a></li><li><a href="#polygon">polygon</a></li><li><a href="#constant">constant</a></li></ul></li></ul></li><li><a href="#references">References</a></li></ul></li></ul></div><p>Detecting polygon intersections is a common task in game development and interactive computer graphics. In this post, I describe a polygon intersection algorithm, including how to determine whether a point lies inside a polygon. The examples are implemented using the popular game development engine <a href="https://love2d.org/">Löve2D</a>.</p><h2 id="polysec-library">Polysec library<a class="headerlink" href="#polysec-library" title="Permanent link">#</a></h2><p><img alt="Polysec Logo" src="https://www.whoop.ee/assets/img/polysec.svg"></p><p><a href="https://github.com/dknight/polysec"><em>Polysec</em></a> is a framework-agnostic Lua library for detecting intersections and collisions between polygons and rectangles. It provides an efficient algorithm for polygonal intersection detection, making it suitable for the collision handling. While Polysec is independent of any specific framework, it is framework-agnostic.</p><h2 id="features">Features<a class="headerlink" href="#features" title="Permanent link">#</a></h2><ul><li>Detect point belongs to polygon or rectangle.</li><li>Detect collision of rectangles.</li><li>Detect collision of polygons.</li><li>Measure distance between who points.</li></ul><p><img alt="Polygon intersection animated demonstration in GIF format" src="https://www.whoop.ee/assets/img/polysec-demo.gif"></p><p><a href="https://github.com/dknight/polysec">Download the source code</a> from GitHub.</p><h2 id="weiler-athethon-algorithm-shortly">Weiler-Athethon algorithm shortly<a class="headerlink" href="#weiler-athethon-algorithm-shortly" title="Permanent link">#</a></h2><p>Under the hood <em>Polysec</em> uses the <a href="https://en.wikipedia.org/wiki/Weiler%E2%80%93Atherton_clipping_algorithm">Weiler-Athethon algorithm</a> to detect polygon intersections.</p><h3 id="algorithm-preconditions">Algorithm Preconditions<a class="headerlink" href="#algorithm-preconditions" title="Permanent link">#</a></h3><p>Before applying the algorithm to a polygon, the following conditions must be met:</p><ul><li>Polygons must be oriented in a clockwise direction.</li><li>Polygons must not be self-intersected (i.e., they should not be re-entrant).</li></ul><h3 id="algorithm-steps">Algorithm Steps<a class="headerlink" href="#algorithm-steps" title="Permanent link">#</a></h3><p>Given polygon A (clipping region) and polygon B (subject region) to be clipped, the algorithm proceeds as follows:</p><ol><li>List the vertices of both polygon A and polygon B.</li><li>Classify each vertex of polygon B as either inside or outside of polygon A.</li><li>Identify all intersection points between the polygons and insert them into both vertex lists, ensuring they are at the intersection points.</li><li>Determine &ldquo;inbound&rdquo; intersections, where the vector from an intersection to the next vertex of polygon B originates inside the clipping region A.</li><li>Traverse the lists, following each intersection in a clockwise direction until returning to the starting position.</li></ol><h3 id="handling-no-intersection-cases">Handling no intersection cases<a class="headerlink" href="#handling-no-intersection-cases" title="Permanent link">#</a></h3><p>If no intersections are found, one of the following must be true:</p><ul><li>Polygon A is entirely inside Polygon B.</li><li>Polygon B is entirely inside Polygon A.</li><li>Polygons A and B do not overlap.</li></ul><p><img alt="Illustration of the Weiler-Athethon algorithm" src="https://www.whoop.ee/assets/img/weiler-Athethon-algorithm-01.svg"></p><h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h2><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">polysec</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">polygon</span> <span class="o">=</span> <span class="n">polysec</span><span class="p">.</span><span class="n">polygon</span>
<span class="kd">local</span> <span class="n">point</span> <span class="o">=</span> <span class="n">polysec</span><span class="p">.</span><span class="n">point</span>

<span class="kd">local</span> <span class="n">square</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">.</span><span class="n">new</span><span class="p">(</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="p">)</span>
<span class="kd">local</span> <span class="n">triangle</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">.</span><span class="n">new</span><span class="p">(</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mf">62.5</span><span class="p">,</span> <span class="mi">225</span><span class="p">),</span>
    <span class="n">point</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- If polygons are not overlapping, nil and false are returned. Otherwise</span>
<span class="c1">-- returns clipping polygon and true.</span>
<span class="kd">local</span> <span class="n">clip</span><span class="p">,</span> <span class="n">overlaps</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">triangle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is overlapping: &quot;</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">overlaps</span><span class="p">))</span>
<span class="kr">if</span> <span class="n">clip</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">clip</span><span class="p">)</span> <span class="kr">do</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Point &quot;</span> <span class="o">..</span> <span class="n">i</span> <span class="o">..</span> <span class="s2">&quot;: {x = &quot;</span> <span class="o">..</span> <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">..</span> <span class="s2">&quot;, y = &quot;</span> <span class="o">..</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">..</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="kr">end</span>
<span class="c1">-- Output:</span>
<span class="cm">--[[</span>
<span class="cm">Is overlapping: true</span>
<span class="cm">Point 1: {x = 109.375, y = 150.0}</span>
<span class="cm">Point 2: {x = 100.0, y = 165.0}</span>
<span class="cm">Point 3: {x = 100, y = 150}</span>
<span class="cm">--]]</span>
</code></pre></div><div class="admonition tip"><p class="admonition-title">Tip</p><p>If you&rsquo;re working exclusively with rectangles, use the <code>rectangle</code> module for a simpler and more efficient algorithm. For non-rectangular polygons, opt for the <code>polygon</code> module.</p></div><h2 id="running-demos">Running demos<a class="headerlink" href="#running-demos" title="Permanent link">#</a></h2><p>Demos are written in <a href="https://love2d.org/">Löve2D Framework</a>. To run demos Löve2D should be installed on your machine.</p><p>Use relative paths for demos; this keeps the import path correct.</p><div class="codehilite"><pre><span></span><code>love<span class="w"> </span>./demos/point-inside
love<span class="w"> </span>./demos/polygons-intersection
love<span class="w"> </span>./demos/rectangles-intersection
</code></pre></div><h2 id="tests">Tests<a class="headerlink" href="#tests" title="Permanent link">#</a></h2><p>Unit-tests are performed using <a href="https://github.com/dknight/laura/">Laura testing framework</a>. Linting is performed using <a href="https://github.com/mpeterv/luacheck">luacheck</a>.</p><p>Unit tests</p><div class="codehilite"><pre><span></span><code>laura<span class="w"> </span>.
</code></pre></div><p>Lint (code quality)</p><div class="codehilite"><pre><span></span><code>luacheck<span class="w"> </span>src<span class="w"> </span><span class="nb">test</span>
</code></pre></div><p>With make software</p><div class="codehilite"><pre><span></span><code>make<span class="w"> </span>lint<span class="w"> </span><span class="nb">test</span>
</code></pre></div><h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">#</a></h2><h3 id="types">Types<a class="headerlink" href="#types" title="Permanent link">#</a></h3><ul><li><code>Point{x: number, y: number}</code></li><li><code>Rectangle{x: number, y: number, w: number, h: number}</code></li><li><code>Polygon Point[]</code></li></ul><h3 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">#</a></h3><h4 id="point"><code>point</code><a class="headerlink" href="#point" title="Permanent link">#</a></h4><ul><li><code>new(x: number, y: number): Point</code><br>Creates a new point instance with x and y coordinates.</li><li><code>distanceTo(p: Point, q: Point): number</code><br>Computes the distance between two points.</li></ul><h4 id="rectangle"><code>rectangle</code><a class="headerlink" href="#rectangle" title="Permanent link">#</a></h4><ul><li><code>new(x1: number, y1: number, x2; number, y2: number): Rectangle</code><br></li><li><code>new(p: Point, q: Point): Rectangle</code><br>Creates a new rectangle instance.</li><li><code>contains(rect: Rectangle, point: Point): boolean</code><br>Checks is the point inside a rectangle.</li><li><code>overlaps(rect1: Rectangle, rect2: Rectangle): boolean</code><br>Checks two axis-aligned rectangles for the collision.</li><li><code>toList(rect: Rectangle): number</code><br>Converts the rectangle to the array of numbers.</li></ul><h4 id="polygon"><code>polygon</code><a class="headerlink" href="#polygon" title="Permanent link">#</a></h4><ul><li><code>new(...points: Point[]): Polygon</code><br>Creates a new polygon instance.</li><li><code>add(...points: Point[]): nil</code><br>Adds point(s) to the polygon.</li><li><code>toList(): number[]</code><br>Converts polygon to the form of array [x1, y1, x2, y2, y3, y3, &hellip;, xN, yN].</li><li><code>contains(a: Polygon, p: Point): boolean</code><br>Check if a point is inside a polygon <code>a</code> using the winding number method. Point is inside if the winding number is nonzero.</li><li><code>intersects(p1: Point, p2: Point, q1: Point, q2: Point): Point|nil</code><br>Compute the intersection of two line segments {<code>p1</code>, <code>p2</code>} and {<code>q1</code>, <code>q2</code>}. If segments are parallel or incongruent, it returns <code>nil</code>.</li><li><code>overlaps(a: Polygon, b: Polygon): Polygon|nil, boolean</code><br>Checks that two polygons are overlapping each other. If polygons do not overlap <code>nil</code> and <code>false</code>, they are returned; otherwise, clipped polygons and <code>true</code> are returned.</li></ul><h4 id="constant"><code>constant</code><a class="headerlink" href="#constant" title="Permanent link">#</a></h4><ul><li><code>Epslion: number</code><br>A very small number.</li></ul><h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2><ul><li><a href="https://love2d.org/">Löve2D</a></li><li><a href="https://en.wikipedia.org/wiki/Weiler%E2%80%93Atherton_clipping_algorithm">Weiler-Athethon algorithm</a></li></ul><h2>Feedback</h2><p>For feedback, please check the <a href="/me/">contacts</a> section. Before writing, please specify where you came from and who you are. Sometimes spammers go insane. Thank you in advance for your understanding.</p></article><a href="/">&larr; Back to the index page</a></main><footer><hr><p>(c) 2022-2025 <a href="/me/">xdknight</a> Powered by <a href="https://github.com/hmngwy/jenny">Jenny</a> shell blog engine.</p><p>Any images on this website may be used, copied and redistributed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license.</p><p>Any code on this website may be used, copied and redistributed under the <a href="https://opensource.org/license/MIT">MIT</a> license.</p><p>This website does not use cookies or any tracking techniques either. Also, this page is fully accessible, responsive, and readable on any device without a single line of JavaScript.</p></footer></body></html>