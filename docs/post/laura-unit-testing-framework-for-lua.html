<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Documentation for Laura is a lightweight unit-testing framework for Lua with simplicity in mind. "><meta name="keywords" content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal"><meta name="author" content="Dmitri Smirnov"><meta property="og:type" content="website"><meta property="og:url" content="https://www.whoop.ee/post/laura-unit-testing-framework-for-lua.html"><meta property="og:image" content="https://www.whoop.ee/assets/img/whoopee-logo.png"><meta http-equiv="Content-Security-Policy" content="script-src 'self'"><meta http-equiv="Content-Security-Policy" content="object-src 'none'"><title>Documentation for Laura unit-testing framework &mdash; Whoopee</title><link rel="preload" href="/assets/fonts/Perfect_DOS_VGA_437.woff2" as="font"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/css/styles.min.css"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml"><link rel="canonical" href="https://www.whoop.ee/post/laura-unit-testing-framework-for-lua.html"></head><body><header><a href="/"><img src="/assets/img/whoopee-logo.png" width="200" height="172" alt="Whoopee" class="logo"></a><nav class="mainmenu"><a href="/me/">About</a> <a href="/feed.xml">RSS</a></nav></header><main><a href="/">&larr; Back to the index page</a><article><h1>Documentation for Laura unit-testing framework</h1><time datetime="2024-10-05">October 05, 2024</time><p><img alt="Laura avatar" src="/assets/img/laura-512.png"></p><p>Laura is a lightweight unit-testing framework for Lua with simplicity in mind. The framework has no dependencies and is compatible with Lua versions 5.1â€”5.4, luau, LuaJIT and LuaJIT-OpenResty.</p><ul><li>Lightweight and minimalist</li><li>Easy to install and use</li><li>No Dependencies</li><li>Understandable, human-readable feedback</li><li>Compatible with any Lua 5.1+ version and LuaJIT</li></ul><div><input type="checkbox" class="toc-toggle" id="toc-toggle"> <label for="toc-toggle">Table of contents</label></div><div class="toc"><ul><li><a href="#documentation-for-laura-unit-testing-framework">Documentation for Laura unit-testing framework</a><ul><li><a href="#install">Install</a><ul><li><a href="#luarocks">LuaRocks</a></li><li><a href="#makefile">Makefile</a></li><li><a href="#manual-installation">Manual installation</a></li></ul></li><li><a href="#using-command-line-client-cli">Using Command Line Client (CLI)</a><ul><li><a href="#cli-flags">CLI flags</a></li></ul></li><li><a href="#configuration">Configuration</a><ul><li><a href="#rc-file">RC file</a></li><li><a href="#set-config-with-command-line">Set config with command line</a></li><li><a href="#set-configuration-from-api">Set configuration from API</a></li></ul></li><li><a href="#writing-tests">Writing tests</a><ul><li><a href="#using-cli-runner">Using CLI runner</a></li><li><a href="#using-standalone-api">Using standalone API</a></li></ul></li><li><a href="#suite">Suite</a></li><li><a href="#test-case">Test case</a></li><li><a href="#testing-techniques-bdd-tdd">Testing Techniques: BDD, TDD</a></li><li><a href="#skipping-tests">Skipping tests</a></li><li><a href="#only-tests">Only tests</a></li><li><a href="#expect-assertion">Expect (Assertion)</a><ul><li><a href="#some-tips-to-make-functions-testable">Some tips to make functions testable</a></li></ul></li><li><a href="#matchers">Matchers</a><ul><li><a href="#equality">Equality</a><ul><li><a href="#toequal">toEqual</a></li><li><a href="#tobe">toBe</a></li><li><a href="#tobenil">toBeNil</a></li><li><a href="#tobefalsy">toBeFalsy</a></li><li><a href="#tobetruthy">toBeTruthy</a></li><li><a href="#tohavetypeof">toHaveTypeOf</a></li></ul></li><li><a href="#tables">Tables</a><ul><li><a href="#todeepequal">toDeepEqual</a></li><li><a href="#tohavelength">toHaveLength</a></li><li><a href="#tohavekeyslength">toHaveKeysLength</a></li><li><a href="#tohavekey">toHaveKey</a></li></ul></li><li><a href="#numbers">Numbers</a><ul><li><a href="#tobefinite">toBeFinite</a></li><li><a href="#tobecloseto">toBeCloseTo</a></li><li><a href="#tobegreaterthan">toBeGreaterThan</a></li><li><a href="#tobegreaterthanorequal">toBeGreaterThanOrEqual</a></li><li><a href="#tobelessthan">toBeLessThan</a></li><li><a href="#tobelessthanorequal">toBeLessThanOrEqual</a></li></ul></li><li><a href="#strings">Strings</a><ul><li><a href="#tomatch">toMatch</a></li><li><a href="#tocontain">toContain</a></li></ul></li><li><a href="#errors">Errors</a><ul><li><a href="#tofail">toFail</a></li></ul></li><li><a href="#spies">Spies</a><ul><li><a href="#tohavebeencalled">toHaveBeenCalled</a></li><li><a href="#tohavebeencalledonce">toHaveBeenCalledOnce</a></li><li><a href="#tohavebeencalledtimes">toHaveBeenCalledTimes</a></li><li><a href="#tohavebeencalledwith">toHaveBeenCalledWith</a></li><li><a href="#tohavebeenfirstcalledwith">toHaveBeenFirstCalledWith</a></li><li><a href="#tohavebeenlastcalledwith">toHaveBeenLastCalledWith</a></li><li><a href="#tohavebeennthcalledwith">toHaveBeenNthCalledWith</a></li><li><a href="#tohavereturned">toHaveReturned</a></li><li><a href="#tohavereturnedtimes">toHaveReturnedTimes</a></li><li><a href="#tohavereturnedwith">toHaveReturnedWith</a></li><li><a href="#tohavefirstreturnedwith">toHaveFirstReturnedWith</a></li><li><a href="#tohavelastreturnedwith">toHaveLastReturnedWith</a></li><li><a href="#tohaventhreturnedwith">toHaveNthReturnedWith</a></li></ul></li></ul></li><li><a href="#negative-matchers">Negative matchers</a></li><li><a href="#spies-mock-functions">Spies (Mock Functions)</a><ul><li><a href="#use-cases-and-features-of-the-spies">Use cases and features of the Spies</a></li><li><a href="#spy-interface">Spy interface</a><ul><li><a href="#methods">Methods</a></li></ul></li><li><a href="#types">Types</a></li><li><a href="#example-of-spy">Example of Spy</a></li></ul></li><li><a href="#stubs">Stubs</a></li><li><a href="#hooks">Hooks</a><ul><li><a href="#afterall">afterAll</a></li><li><a href="#aftereach">afterEach</a></li><li><a href="#beforeall">beforeAll</a></li><li><a href="#beforeeach">beforeEach</a></li></ul></li><li><a href="#code-coverage">Code coverage</a><ul><li><a href="#inline-disable-coverage">Inline disable coverage</a></li></ul></li><li><a href="#exit-codes">Exit codes</a></li><li><a href="#running-in-docker-container">Running in Docker container</a></li><li><a href="#testing-with-github-actions">Testing with GitHub actions</a></li><li><a href="#who-is-laura-and-how-to-meet-her">Who is Laura? And how to meet her?</a></li><li><a href="#credits">Credits</a></li><li><a href="#contribution">Contribution</a></li></ul></li></ul></div><h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">#</a></h2><p><a href="https://github.com/dknight/laura/">Source code on GitHub</a></p><p>There are several ways to install: LuaRocks, Make utility, and manual.</p><h3 id="luarocks">LuaRocks<a class="headerlink" href="#luarocks" title="Permanent link">#</a></h3><div class="codehilite"><pre><span></span><code>luarocks<span class="w"> </span>install<span class="w"> </span>laura
</code></pre></div><p>&hellip;or use the tree in the user&rsquo;s home directory.</p><div class="codehilite"><pre><span></span><code>luarocks<span class="w"> </span>--local<span class="w"> </span>install<span class="w"> </span>laura
</code></pre></div><h3 id="makefile">Makefile<a class="headerlink" href="#makefile" title="Permanent link">#</a></h3><p>Using the <code>make</code> utility to install.</p><p>Clone the source code.</p><div class="codehilite"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/dknight/laura.git
</code></pre></div><p>Run <code>make</code></p><div class="codehilite"><pre><span></span><code>make<span class="w"> </span>install
</code></pre></div><p>There are variables that can be set with <code>make</code>.</p><ul><li><code>PREFIX</code>: basic installation prefix for the module (default <code>/usr/local</code>);</li><li><code>BINDIR</code>: use the binary path in the file system tree (default <code>${PREFIX}/bin</code>);</li><li><code>LIBDIR</code>: where to put the shared libraries (default <code>${PREFIX}/share/lua/${LUA_VERSION}</code>)</li></ul><p>Consider:</p><div class="codehilite"><pre><span></span><code><span class="nv">PREFIX</span><span class="o">=</span>/opt/lua/libs<span class="w"> </span><span class="nv">BINDIR</span><span class="o">=</span>/opt/bin<span class="w"> </span><span class="nv">LIBDIR</span><span class="o">=</span>/opt/share<span class="w"> </span>make<span class="w"> </span>install
</code></pre></div><h3 id="manual-installation">Manual installation<a class="headerlink" href="#manual-installation" title="Permanent link">#</a></h3><p>Just clone the repository and include the location to <code>LUA_PATH</code> environment variable.</p><h2 id="using-command-line-client-cli">Using Command Line Client (CLI)<a class="headerlink" href="#using-command-line-client-cli" title="Permanent link">#</a></h2><p>After installation, <code>laura</code> executable will be available in OS <code>$PATH</code>. To check version and all available flags, use <code>-h</code> or <code>--help</code> flag.</p><div class="codehilite"><pre><span></span><code>laura<span class="w"> </span>--help
</code></pre></div><h3 id="cli-flags">CLI flags<a class="headerlink" href="#cli-flags" title="Permanent link">#</a></h3><ul><li><code>-c</code>, <code>--config</code>: path to <a href="#configuration">config</a> file, override defaults.</li><li><code>-r</code>, <code>--reporters</code>: comma-separated reporters.</li><li><code>-S</code>, <code>--nosummary</code>: do not print summary; just run the tests without summary information.</li><li><code>-v</code>, <code>--version</code>: print the current version of the Laura framework.</li><li><code>-h</code>, <code>-?</code>, <code>--help</code>: prints the help information.</li></ul><p>Example command:</p><div class="codehilite"><pre><span></span><code>laura<span class="w"> </span>-c<span class="w"> </span>~/my-custom-config.lua<span class="w"> </span>--reporters<span class="w"> </span>text,blank<span class="w"> </span>-S<span class="w"> </span>./tests
</code></pre></div><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">#</a></h2><p>There are open configurations, which can be configured. Config options are in capitalized case due to Lua <code>@enum</code> convention.</p><ul><li><strong>Color</strong>: enables colors in terminal if possible, default <code>true</code>;</li><li><strong>Dir</strong>: directory where tests are located. Current directory <code>.</code> by default;</li><li><strong>TestPattern</strong>: pattern for test files, default <code>"*_test.lua"</code>;</li><li><strong>Tab</strong>: tabulation string, default <code>"\t"</code>;</li><li><strong>Traceback</strong>: print full traceback from debug library on test failure, default <code>false</code>;</li><li><strong>Reporters</strong>: list of reporters, default <code>{ "text" }</code><ul><li>blank</li><li>count</li><li>dot</li><li>text</li></ul></li><li><strong>ReportSummary</strong>: print test summary If the reporter supports it, default <code>true</code>.</li><li><strong>DateFormat</strong>: date format used in coverage reports, default <code>""%Y-%m-%d %H:%M:%S""</code>;</li><li><strong>Coverage</strong>: Coverage config table;<ul><li><strong>Enabled</strong>: disables or enables coverage collection, default <code>false</code>;</li><li><strong>Threshold</strong>: if target coverage is less than the percentage, program will exit with exit code <code>2</code>. Zero or negative value of this option will ignore threshold.</li><li><strong>ThresholdPoints</strong>: break points for coverage show colored output for good, bad, ugly coverage of the file/module.<ul><li>Low: below 66.7%;</li><li>Average: between 66.7%&hellip;90%;</li><li>Good: 90% and up to 100%.</li></ul></li><li><strong>ReportName</strong>: file report name, default <code>"covreport"</code>;</li><li><strong>Dir</strong>: writes reports to this directory, default <code>"coverage"</code>,</li><li><strong>Reporters</strong>: table of possible reporters:<ul><li>blank</li><li>csv</li><li>html</li><li>json</li><li>lua</li><li>terminal</li><li>xml</li></ul></li><li><strong>IncludePattern</strong>: files pattern to include for coverage, default <code>".*%.lua"</code>.</li></ul></li></ul><p>Also, there are <a href="https://github.com/dknight/laura/blob/main/src/laura/Config.lua">&ldquo;private&rdquo; configuration fields</a>, which are not recommended to change unless you know that you know what you are doing.</p><h3 id="rc-file">RC file<a class="headerlink" href="#rc-file" title="Permanent link">#</a></h3><p>Another way to create <a href="https://github.com/dknight/laura/blob/main/.laurarc"><code>.laurarc</code></a> file in your project directory and setup preferences in the same format as in the configuration file.</p><h3 id="set-config-with-command-line">Set config with command line<a class="headerlink" href="#set-config-with-command-line" title="Permanent link">#</a></h3><p>Use the <code>-c</code> flag to pass the path to your config file.</p><div class="codehilite"><pre><span></span><code>laura<span class="w"> </span>-c<span class="w"> </span>./path-to-config-file.lua<span class="w"> </span>.
</code></pre></div><h3 id="set-configuration-from-api">Set configuration from API<a class="headerlink" href="#set-configuration-from-api" title="Permanent link">#</a></h3><p>Use <code>setup</code> method from <code>laura</code> module to set configuration from the API.</p><p>Consider:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>

<span class="n">laura</span><span class="p">.</span><span class="n">setup</span><span class="p">({</span>
  <span class="n">ReportSummary</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
  <span class="n">Dir</span> <span class="o">=</span> <span class="s2">&quot;./specs&quot;</span><span class="p">,</span>
  <span class="n">Pattern</span> <span class="o">=</span> <span class="s2">&quot;*.spec.lua&quot;</span><span class="p">,</span>
  <span class="c1">-- etc.</span>
 <span class="p">})</span>

<span class="c1">-- rest of the code</span>
</code></pre></div><h2 id="writing-tests">Writing tests<a class="headerlink" href="#writing-tests" title="Permanent link">#</a></h2><h3 id="using-cli-runner">Using CLI runner<a class="headerlink" href="#using-cli-runner" title="Permanent link">#</a></h3><p>Writing tests is pretty simple and straightforward. Create a file with the suffix <code>*_test.lua</code> (the suffix can be changed in the <a href="#configuration">configuration</a>).</p><p>Consider <strong>simple_test.lua</strong>:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">it</span>
<span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">describe</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">expect</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;my test case&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be equal to three&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>After this run code snippet, just run the command:</p><div class="codehilite"><pre><span></span><code>laura
</code></pre></div><p>Output is similar to:</p><div class="codehilite"><pre><span></span><code>my test case
        [passing] should be equal to three (1.1ms)

SUMMARY
1 of 1 passing
0 failing
0 skipping

time: â‰ˆ1.0ms / mem: 20.80KB @ Sun Sep 29 02:09:02 2024
pass
</code></pre></div><h3 id="using-standalone-api">Using standalone API<a class="headerlink" href="#using-standalone-api" title="Permanent link">#</a></h3><p>If, for some reason, CLI is not an option or there is a need for more complex logic. There is an option to use the API.</p><p>Consider <strong>api_test.lua</strong>:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">TextReporter</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.reporters.text&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">it</span>
<span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">describe</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">expect</span>
<span class="kd">local</span> <span class="n">Runner</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">Runner</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;my test case&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be equal to three&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">results</span> <span class="o">=</span> <span class="n">runner</span><span class="p">:</span><span class="n">runTests</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">reporter</span> <span class="o">=</span> <span class="n">TextReporter</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">reporter</span><span class="p">:</span><span class="n">report</span><span class="p">()</span>
<span class="n">runner</span><span class="p">:</span><span class="n">done</span><span class="p">()</span>
</code></pre></div><p>Use Lua interpreter to run the example above; use command:</p><div class="codehilite"><pre><span></span><code>lua<span class="w"> </span>api_test.lua
</code></pre></div><h2 id="suite">Suite<a class="headerlink" href="#suite" title="Permanent link">#</a></h2><p>A test suite is a collection of test cases that are grouped together to test a particular piece of software, a specific functionality, or an entire application. Test suites help in organizing and running tests in a structured and efficient way, ensuring that multiple tests can be executed as part of a single execution flow.</p><p>Consider:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;Everything related to API module&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
  <span class="c1">-- test cases</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>Or using suite <a href="#testing-techniques-bdd-tdd"><abbr title="Behaviour Driven Development">BDD</abbr></a> style:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">suite</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>

<span class="n">suite</span><span class="p">(</span><span class="s2">&quot;API module&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="c1">-- test cases</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="test-case">Test case<a class="headerlink" href="#test-case" title="Permanent link">#</a></h2><p>A test case is a specific scenario or condition under which a tester or developer determines whether a piece of software (e.g., a function, module, or feature) behaves as expected. It typically consists of an input, execution conditions, and expected results that validate a particular function or feature of the unit.</p><p>Consider:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;Everything related to API module&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should execute something and be true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="c1">-- expect the condition</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>Or using suite <a href="#testing-techniques-bdd-tdd"><abbr title="Behaviour Driven Development">BDD</abbr></a> style:</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">suite</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">when</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>

<span class="n">suite</span><span class="p">(</span><span class="s2">&quot;API module&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">when</span><span class="p">(</span><span class="s2">&quot;function XXX executes it returns true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="c1">-- expect the condition</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="testing-techniques-bdd-tdd">Testing Techniques: <abbr title="Behaviour Driven Development">BDD</abbr>, <abbr title="Test Driven Development">TDD</abbr><a class="headerlink" href="#testing-techniques-bdd-tdd" title="Permanent link">#</a></h2><p>There are different techniques; like <abbr title="Test Driven Development">TDD</abbr>, <abbr title="Behaviour Driven Development">BDD</abbr>, etc. Explanation of them is out-of-scope of this article; just search on <a href="https://duckduckgo.com/?q=bbd+vs+tdd">the web definition and difference of them</a>.</p><h2 id="skipping-tests">Skipping tests<a class="headerlink" href="#skipping-tests" title="Permanent link">#</a></h2><p>There is a possibility to skip the test case or suite using the <code>skip</code> method. Skipped tests won&rsquo;t run and will be reported as <strong>[SKIPPED]</strong>. Please note that there is a <code>:</code> colon. If you mark a suite as skipped, all its children will also be skipped.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">it</span>
<span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">describe</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">expect</span>

<span class="n">describe</span><span class="p">:</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;skipped suite&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">:</span><span class="n">sli</span><span class="p">(</span><span class="s2">&quot;should be skipped&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="only-tests">Only tests<a class="headerlink" href="#only-tests" title="Permanent link">#</a></h2><p>Like skipped tests, mark tests with <code>only</code>; only marked tests will run; others will be ignored, useful for debugging.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">laura</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">it</span>
<span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">describe</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="n">laura</span><span class="p">.</span><span class="n">expect</span>

<span class="n">describe</span><span class="p">:</span><span class="n">only</span><span class="p">(</span><span class="s2">&quot;only suite&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be three&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="expect-assertion">Expect (Assertion)<a class="headerlink" href="#expect-assertion" title="Permanent link">#</a></h2><p>When a function is being tested, often it is checked to meet certain conditions. <code>expect</code> (or assertion) gives such possibility. The idea is like native Lua&rsquo;s <code>assert(ok, error)</code> function. If the first argument is <code>true</code>, then assertion is successful; otherwise, assertion will <strong>fail</strong> with a second argument error; usually it stops the program.</p><p>Laura is just a wrapper around <code>assert</code> function with a much larger scope of features and test structure and organization.</p><p>The syntax of expect is pretty simple:</p><div class="codehilite"><pre><span></span><code><span class="n">expect</span><span class="p">(</span><span class="n">ActualValue</span><span class="p">).</span><span class="n">toMatcher</span><span class="p">(</span><span class="n">ExpectedValue</span><span class="p">)</span>
</code></pre></div><p>Where:</p><ul><li><strong>ActualValue</strong>: value to be tested.</li><li><strong>ExpectedValue</strong>: expected that ExpectedValue meets the condition for ActualValue.</li><li><strong>toMatcher</strong>: matcher function which specifies the conditions, check predefined <a href="#matchers">matchers</a> below.</li></ul><h3 id="some-tips-to-make-functions-testable">Some tips to make functions testable<a class="headerlink" href="#some-tips-to-make-functions-testable" title="Permanent link">#</a></h3><ul><li>Use the &ldquo;pure function&rdquo; concept from the functional programming paradigm. This means that the function always returns the same value(s) with the same argument(s). This approach helps to avoid side effects.</li><li>Keep functions so small that they do only 1 thing. Do not try to write large universal function, the smaller functions much easier to test and maintain.</li><li>Less arguments the better; personally, I prefer not more than 3. If there are more, it is hard to remember which argument and what its order is.</li><li>Lua specific rule. Lua supports multiple values to be returned. I would prefer to return not more than two. There might be issues. which is hard to detect when a function returns more than one value.</li></ul><p>Of course there are exceptions to these rules. These are best practices and my personal recommendation based on experience. It is up to you.</p><h2 id="matchers">Matchers<a class="headerlink" href="#matchers" title="Permanent link">#</a></h2><h3 id="equality">Equality<a class="headerlink" href="#equality" title="Permanent link">#</a></h3><h4 id="toequal"><code>toEqual</code><a class="headerlink" href="#toequal" title="Permanent link">#</a></h4><p>Uses the equality <code>==</code> operator to compare the values.</p><p>Do not use <code>toEqual</code> when:</p><ul><li>Comparing float values, e.g., 0.2 + 0.3 might be equal to something like 0.50000000001. Use <a href="#tobecloseto"><code>toBeCloseTo</code></a> to compare float numbers.</li><li>Be careful with tables. Tables in Lua are references; the equality operator <code>==</code> compares references, not key-value pairs. To compare tables by values, use <a href="#todeepequal"><code>toDeepEqual</code></a> (or its alias <a href="#tobe"><code>toBe</code></a>).</li></ul><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">Tim</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Tim&quot;</span><span class="p">,</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
    <span class="n">boy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;toEqual&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be 13 years old&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">Tim</span><span class="p">.</span><span class="n">age</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be Tim&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">Tim</span><span class="p">.</span><span class="n">name</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="s2">&quot;Tim&quot;</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be boy&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">Tim</span><span class="p">.</span><span class="n">boy</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have been play Doom 1&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">Tim</span><span class="p">.</span><span class="n">playedDoom1</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobe"><code>toBe</code><a class="headerlink" href="#tobe" title="Permanent link">#</a></h4><p>Alias of <a href="#todeepequal"><code>toDeepEqual</code></a>.</p><h4 id="tobenil"><code>toBeNil</code><a class="headerlink" href="#tobenil" title="Permanent link">#</a></h4><p>If there is a need to check that something is <code>nil</code> use <code>toBeNil</code> matcher. In Lua, everything that is not defined is <code>nil</code>.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">beepBoop</span><span class="p">()</span>
    <span class="c1">-- by default nil is returned</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;bloop returns null&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">beepBoop</span><span class="p">()).</span><span class="n">toBeNil</span><span class="p">();</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobefalsy"><code>toBeFalsy</code><a class="headerlink" href="#tobefalsy" title="Permanent link">#</a></h4><p>Checks that value is false; in Lua everything expects <code>nil</code> and <code>false</code> is true.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">redIsNotBlue</span><span class="p">()</span>
    <span class="kr">return</span> <span class="s2">&quot;red&quot;</span> <span class="o">==</span> <span class="s2">&quot;blue&quot;</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;beepBoop returns nil&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">redIsNotBlue</span><span class="p">()).</span><span class="n">toBeFalsy</span><span class="p">();</span>
<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">beepBoop</span><span class="p">()</span>
    <span class="c1">-- by default nil is returned</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;beepBoop returns nil&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">beepBoop</span><span class="p">()).</span><span class="n">toBeFalsy</span><span class="p">();</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobetruthy"><code>toBeTruthy</code><a class="headerlink" href="#tobetruthy" title="Permanent link">#</a></h4><p>Checks that value is true; in Lua, everything else expects <code>nil</code> and <code>false</code> is true.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">isDarkAtNight</span><span class="p">()</span>
    <span class="kr">return</span> <span class="kc">true</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;beepBoop returns nil&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">isDarkAtNight</span><span class="p">()).</span><span class="n">toBeTruthy</span><span class="p">();</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavetypeof"><code>toHaveTypeOf</code><a class="headerlink" href="#tohavetypeof" title="Permanent link">#</a></h4><p>Checks type of the value.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s1">&#39;should be a number&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="mi">123</span><span class="p">).</span><span class="n">toHaveTypeOf</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">);</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;should be a string&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">).</span><span class="n">toHaveTypeOf</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">);</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;should be a nil&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">(</span><span class="kc">nil</span><span class="p">).</span><span class="n">toHaveTypeOf</span><span class="p">(</span><span class="s2">&quot;nil&quot;</span><span class="p">);</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s1">&#39;should be a table&#39;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
  <span class="n">expect</span><span class="p">({</span><span class="n">a</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">13</span><span class="p">}).</span><span class="n">toHaveTypeOf</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">);</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- etc. </span>
</code></pre></div><h3 id="tables">Tables<a class="headerlink" href="#tables" title="Permanent link">#</a></h3><h4 id="todeepequal"><code>toDeepEqual</code><a class="headerlink" href="#todeepequal" title="Permanent link">#</a></h4><p><code>toDeepEqual</code> works similar to <code>toEqual</code> with one exception: for types which are references; it compares by value, not by reference. Usually this is how tables are compared: two tables have the same values, but these might have different memory addresses. Also, there is an alias for this matcher <a href="#tobe"><code>toBe</code></a>.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">fruits1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">apples</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">oranges</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">bananas</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="kd">local</span> <span class="n">fruits2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">apples</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">oranges</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">bananas</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have different references&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">fruits1</span><span class="p">).</span><span class="n">notToEqual</span><span class="p">(</span><span class="n">fruits2</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be same values&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">fruits1</span><span class="p">).</span><span class="n">toDeepEqual</span><span class="p">(</span><span class="n">fruits2</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>In the example above, 2 different tables have the same value but different references. So in the sense of computer memory, these are different tables which have the same values.</p><h4 id="tohavelength"><code>toHaveLength</code><a class="headerlink" href="#tohavelength" title="Permanent link">#</a></h4><p>Use the <code>#</code> length operator to match the table length. Be careful with &ldquo;gaps&rdquo; in the arrays. For more details, read about the <a href="https://www.lua.org/manual/5.4/manual.html#3.4.7">length operator</a> from Lua manual.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">fibonacci</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span> <span class="p">}</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have 6 first fibonacci numbers&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">).</span><span class="n">toHaveLength</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavekeyslength"><code>toHaveKeysLength</code><a class="headerlink" href="#tohavekeyslength" title="Permanent link">#</a></h4><p>Counts the table&rsquo;s keys that are not <code>nil</code>.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">pets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Barsik&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;dog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Woofey&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;hamster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cookie&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;rat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lara&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have 4 animals&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">pets</span><span class="p">).</span><span class="n">toHaveKeysLength</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavekey"><code>toHaveKey</code><a class="headerlink" href="#tohavekey" title="Permanent link">#</a></h4><p>Looks for specific key in the table.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">pets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Barsik&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;dog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Woofey&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;hamster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cookie&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;rat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lara&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have a cat&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">pets</span><span class="p">).</span><span class="n">toHaveKey</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should not to have a panda&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">pets</span><span class="p">).</span><span class="n">notToHaveKey</span><span class="p">(</span><span class="s2">&quot;panda&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h3 id="numbers">Numbers<a class="headerlink" href="#numbers" title="Permanent link">#</a></h3><h4 id="tobefinite"><code>toBeFinite</code><a class="headerlink" href="#tobefinite" title="Permanent link">#</a></h4><p>The given number is finite. In Lua values <code>math.huge</code>, <code>-math.huge</code> and <code>n / 0</code> may be threatened as &ldquo;infinity&rdquo;.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be infinite&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">math.huge</span><span class="p">).</span><span class="n">notToBeFinite</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should infinite if divide by zero&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">42</span> <span class="o">/</span> <span class="mi">0</span><span class="p">).</span><span class="n">notToBeFinite</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be finite&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">555</span><span class="p">).</span><span class="n">toBeFinite</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobecloseto"><code>toBeCloseTo</code><a class="headerlink" href="#tobecloseto" title="Permanent link">#</a></h4><p><code>toBeCloseTo</code> is used to compare float numbers. At expected value, it can accept a table, where the first value is a number. The second value is the precision number of digits (default 2).</p><p>Mathematical test criteria is <strong>|10<sup>-precision / 2</sup>|</strong>, Lua code <code>math.abs(10 ** -precision) / 2</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be close with default precision 2&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mf">4.715</span><span class="p">).</span><span class="n">toBeCloseTo</span><span class="p">(</span><span class="mf">4.72</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be close with precision 4&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mf">4.7777</span><span class="p">).</span><span class="n">toBeCloseTo</span><span class="p">({</span> <span class="mf">4.77765</span><span class="p">,</span> <span class="mi">4</span> <span class="p">})</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobegreaterthan"><code>toBeGreaterThan</code><a class="headerlink" href="#tobegreaterthan" title="Permanent link">#</a></h4><p>Test the condition <code>actual &gt; expected</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be greater than 40&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="n">toBeGreaterThan</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobegreaterthanorequal"><code>toBeGreaterThanOrEqual</code><a class="headerlink" href="#tobegreaterthanorequal" title="Permanent link">#</a></h4><p>Test the condition <code>actual &gt;= expected</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be greater or equal than 42&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="n">toBeGreaterThanOrEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobelessthan"><code>toBeLessThan</code><a class="headerlink" href="#tobelessthan" title="Permanent link">#</a></h4><p>Test the condition <code>actual &lt; expected</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be less than 44&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="n">toBeLessThan</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tobelessthanorequal"><code>toBeLessThanOrEqual</code><a class="headerlink" href="#tobelessthanorequal" title="Permanent link">#</a></h4><p>Test the condition <code>actual &lt;= expected</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be less or equal than 42&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="n">toBeLessThanOrEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h3 id="strings">Strings<a class="headerlink" href="#strings" title="Permanent link">#</a></h3><h4 id="tomatch"><code>toMatch</code><a class="headerlink" href="#tomatch" title="Permanent link">#</a></h4><p>Use <code>toMatch</code> to check that a string matches a <a href="https://www.lua.org/manual/5.4/manual.html#6.4.1">pattern</a>. Please consider, that Lua&rsquo;s patterns differ from POSIX-compatible regular expressions.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should match substring&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">).</span><span class="n">toMatch</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should match float number&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;-12.43256&quot;</span><span class="p">).</span><span class="n">toMatch</span><span class="p">(</span><span class="s2">&quot;^-?%d+%.%d+$&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tocontain"><code>toContain</code><a class="headerlink" href="#tocontain" title="Permanent link">#</a></h4><p>Use<code>toContain</code> when there is a need to check that an item is in an array or string.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have a cat in a table&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">({</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;panda&quot;</span><span class="p">}).</span><span class="n">toContain</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should have a cat in a string&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Grey cat jumped out of window&quot;</span><span class="p">).</span><span class="n">toContain</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h3 id="errors">Errors<a class="headerlink" href="#errors" title="Permanent link">#</a></h3><h4 id="tofail"><code>toFail</code><a class="headerlink" href="#tofail" title="Permanent link">#</a></h4><p>Check that function failed due to execution. The expected value can be a <code>string</code>, which is Lua <a href="https://www.lua.org/manual/5.4/manual.html#6.4.1">pattern</a> that matches the error message.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">errorFn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;something went wrong&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should fail&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">errorFn</span><span class="p">).</span><span class="n">toFail</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should fail and match error pattern&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">errorFn</span><span class="p">).</span><span class="n">toFail</span><span class="p">(</span><span class="s2">&quot;wrong&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h3 id="spies">Spies<a class="headerlink" href="#spies" title="Permanent link">#</a></h3><h4 id="tohavebeencalled"><code>toHaveBeenCalled</code><a class="headerlink" href="#tohavebeencalled" title="Permanent link">#</a></h4><p><code>toHaveBeenCalled</code> ensures that a spy has been called any number of times.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">eatCandy</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eat a candy&quot;</span><span class="p">)</span>
    <span class="n">callback</span><span class="p">()</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">eatCandy</span><span class="p">(</span><span class="n">spy</span><span class="p">)</span>
    <span class="n">eatCandy</span><span class="p">(</span><span class="n">spy</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalled</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeencalledonce"><code>toHaveBeenCalledOnce</code><a class="headerlink" href="#tohavebeencalledonce" title="Permanent link">#</a></h4><p><code>toHaveBeenCalledOnce</code> ensures that a spy has been called only once.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">eatCandy</span><span class="p">(</span><span class="n">spy</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalled</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeencalledtimes"><code>toHaveBeenCalledTimes</code><a class="headerlink" href="#tohavebeencalledtimes" title="Permanent link">#</a></h4><p><code>toHaveBeenCalledTimes</code> ensures that a spy has been called an exact number of times.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called 4 times&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="kr">do</span>
        <span class="n">eatCandy</span><span class="p">(</span><span class="n">spy</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeencalledwith"><code>toHaveBeenCalledWith</code><a class="headerlink" href="#tohavebeencalledwith" title="Permanent link">#</a></h4><p><code>toHaveBeenCalledWith</code> ensures that a spy has been called with a specific argument. The arguments are checked with the logical equality <code>==</code>.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">meals</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;soup&quot;</span><span class="p">,</span> <span class="s2">&quot;meat&quot;</span><span class="p">,</span> <span class="s2">&quot;dessert&quot;</span> <span class="p">}</span>

<span class="kd">local</span> <span class="n">eat</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">meal</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eating&quot;</span> <span class="o">..</span> <span class="s2">&quot; &quot;</span> <span class="o">..</span> <span class="n">meal</span><span class="p">)</span>
    <span class="n">callback</span><span class="p">()</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called with &#39;meat&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalledWith</span><span class="p">(</span><span class="s2">&quot;meat&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeenfirstcalledwith"><code>toHaveBeenFirstCalledWith</code><a class="headerlink" href="#tohavebeenfirstcalledwith" title="Permanent link">#</a></h4><p><code>toHaveBeenFirstCalledWith</code> ensures that the first call of a spy has been called with a specific argument. The arguments are checked with the logical equality <code>==</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be firstly called with &#39;soup&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenFirstCalledWith</span><span class="p">(</span><span class="s2">&quot;soup&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeenlastcalledwith"><code>toHaveBeenLastCalledWith</code><a class="headerlink" href="#tohavebeenlastcalledwith" title="Permanent link">#</a></h4><p><code>toHaveBeenLastCalledWith</code> ensures that the last call of a spy has been called with a specific argument. The arguments are checked with the logical equality <code>==</code>.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be lastly called with &#39;dessert&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenLastCalledWith</span><span class="p">(</span><span class="s2">&quot;dessert&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavebeennthcalledwith"><code>toHaveBeenNthCalledWith</code><a class="headerlink" href="#tohavebeennthcalledwith" title="Permanent link">#</a></h4><p><code>toHaveBeenNthCalledWith</code> ensures that the n-th call of a spy has been called with a specific argument. The arguments are checked with the logical equality <code>==</code>. As expected value, it accepts the table argument, where the first value is the position (index) of a call and the second is expected value.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be secondly called with &#39;meat&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">vmeal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenNthCalledWith</span><span class="p">({</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;meat&quot;</span> <span class="p">})</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavereturned"><code>toHaveReturned</code><a class="headerlink" href="#tohavereturned" title="Permanent link">#</a></h4><p>Test a spy that returned a non-<code>nil</code> value and did not throw any error at least once.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should return a value&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">spy</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveReturned</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavereturnedtimes"><code>toHaveReturnedTimes</code><a class="headerlink" href="#tohavereturnedtimes" title="Permanent link">#</a></h4><p>Test a spy that returned a non-<code>nil</code> value and did not throw any error at least once.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">getMeal</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">meals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="kr">end</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should return all meals&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">getMeal</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">i</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveReturnedTimes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavereturnedwith"><code>toHaveReturnedWith</code><a class="headerlink" href="#tohavereturnedwith" title="Permanent link">#</a></h4><p>Test a spy that returned with a certain value and did not throw any error.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be return with argument&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveReturnedWith</span><span class="p">(</span><span class="s2">&quot;meat&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavefirstreturnedwith"><code>toHaveFirstReturnedWith</code><a class="headerlink" href="#tohavefirstreturnedwith" title="Permanent link">#</a></h4><p>Test a spy&rsquo;s first return with a certain value and did not throw any error.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be return with argument&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveFirstReturnedWith</span><span class="p">(</span><span class="s2">&quot;soup&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohavelastreturnedwith"><code>toHaveLastReturnedWith</code><a class="headerlink" href="#tohavelastreturnedwith" title="Permanent link">#</a></h4><p>Test a spy&rsquo;s last return with a certain value and did not throw any error.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be return with argument&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveLastReturnedWith</span><span class="p">(</span><span class="s2">&quot;dessert&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h4 id="tohaventhreturnedwith"><code>toHaveNthReturnedWith</code><a class="headerlink" href="#tohaventhreturnedwith" title="Permanent link">#</a></h4><p>Test a spy&rsquo;s last return with a certain value and did not throw any error. Expected value is a table where the first value is an index. (position) of the return, the second value is the expected value.</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be return with argument&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kr">return</span> <span class="n">a</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">meal</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">meals</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">spy</span><span class="p">(</span><span class="n">meal</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveNthReturnedWith</span><span class="p">({</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;meat&quot;</span> <span class="p">})</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="negative-matchers">Negative matchers<a class="headerlink" href="#negative-matchers" title="Permanent link">#</a></h2><p>Any matcher can be inverted with the prefix <strong>not</strong> and after following the same camelCase convention. E.g., <code>toEqual</code> =&gt; <code>notToEqual</code>, <code>toBe</code> =&gt; <code>notToBe</code> and so on.</p><p>Consider:</p><div class="codehilite"><pre><span></span><code><span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be &#39;hello&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">).</span><span class="n">toEqual</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">it</span><span class="p">(</span><span class="s2">&quot;should not be &#39;hello&#39;&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">).</span><span class="n">notToEqual</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="spies-mock-functions">Spies (Mock Functions)<a class="headerlink" href="#spies-mock-functions" title="Permanent link">#</a></h2><p>Spies are especially useful in unit tests where you want to isolate the component or function being tested from its dependencies, ensuring the test focuses on the behavior of the specific unit.</p><h3 id="use-cases-and-features-of-the-spies">Use cases and features of the Spies<a class="headerlink" href="#use-cases-and-features-of-the-spies" title="Permanent link">#</a></h3><ul><li><strong>Isolating Tests</strong>: encapsulate unit that it will run independently from the rest environment.</li><li><strong>Testing Side Effects</strong>: ensure that function has returned certain value with certain arguments</li><li><strong>Capture calls, arguments, and return values</strong>: spy tracks how many times it is called, simulating arguments and return values as it would be real case.</li><li><strong>Simulate Errors</strong>: ensure that unit is not crashing the program, if there is an error. This is a very important case that makes function error-prone.</li></ul><h3 id="spy-interface">Spy interface<a class="headerlink" href="#spy-interface" title="Permanent link">#</a></h3><h4 id="methods">Methods<a class="headerlink" href="#methods" title="Permanent link">#</a></h4><p>There are public methods of the <a href="https://github.com/dknight/laura/blob/main/src/laura/Spy.lua">Spy</a> class.</p><ul><li><strong>getCalls(): SpyCall[]</strong>: return all calls;</li><li><strong>getCall(n): SpyCall | nil</strong>: returns the n-nth call, <code>nil</code> when it does not exist;</li><li><strong>getLastCall(): SpyCall | nil</strong>: returns the last call, <code>nil</code> when it does not exist;</li><li><strong>getFirstCall(): SpyCall | nil</strong>: returns the first call, <code>nil</code> when it does not exist;</li><li><strong>getCallsCount(): number</strong>: returns total amount of calls;</li><li><strong>getReturns(): SpyReturn[]</strong>: returns table of return values;</li><li><strong>getReturn(n): SpyReturn | nil</strong>: returns the n-th return value, <code>nil</code> when it does not exist;</li><li><strong>getFirstReturn(): SpyReturn | nil</strong>: returns the first return value, <code>nil</code> when it does not exist;</li><li><strong>getLastReturn(): SpyReturn | nil</strong>: returns the last return value, <code>nil</code> when it does not exist;</li><li><strong>getReturnsCount(): number</strong>: returns the total amount of return values, which are not <code>nil</code>.</li></ul><h3 id="types">Types<a class="headerlink" href="#types" title="Permanent link">#</a></h3><p>Note: in the current version, types are just aliases to <code>table</code>, but later this helps to extend the framework with a better typing system.</p><ul><li><code>---@alias SpyArgs table</code></li><li><code>---@alias SpyCall table</code></li><li><code>---@alias SpyReturn table</code></li></ul><h3 id="example-of-spy">Example of Spy<a class="headerlink" href="#example-of-spy" title="Permanent link">#</a></h3><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.expect&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">Spy</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Spy&quot;</span><span class="p">)</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;testing spies&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called once&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> 
        <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
        <span class="n">spy</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalledOnce</span><span class="p">()</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be called once&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> 
        <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
        <span class="n">spy</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalledWith</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="stubs">Stubs<a class="headerlink" href="#stubs" title="Permanent link">#</a></h2><p>Stubs are the mock values of any table, useful for simulating the implementation.Functions from Lua standard library can also be stubbed. After the test, do not forget to restore stub <code>Stub:restore()</code>, which restores the original field or function.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">stubFn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
    <span class="kr">return</span> <span class="s2">&quot;external program `&quot;</span> <span class="o">..</span> <span class="n">prog</span> <span class="o">..</span> <span class="s2">&quot;` is not permitted&quot;</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">stub</span> <span class="o">=</span> <span class="n">Stub</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="n">stubFn</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">os.execute</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">)).</span><span class="n">toEqual</span><span class="p">(</span><span class="s2">&quot;external program `ls` is not permitted&quot;</span><span class="p">)</span>
<span class="n">stub</span><span class="p">:</span><span class="n">restore</span><span class="p">()</span> <span class="c1">-- Restores the original `execute()` function of `os` module.</span>
</code></pre></div><h2 id="hooks">Hooks<a class="headerlink" href="#hooks" title="Permanent link">#</a></h2><p>Suite has hooks run functions, which help to setup some state after or before all test cases.</p><h3 id="afterall">afterAll<a class="headerlink" href="#afterall" title="Permanent link">#</a></h3><p>The hook runs once after all test cases in the suite. This is often useful if there is a need to clean up some global setup state that is shared across tests.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.expect&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">hooks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.hooks&quot;</span><span class="p">)</span>

<span class="c1">-- abstract function of closing database</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">closeDatabase</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database closed&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;afterAll hook&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">hooks</span><span class="p">.</span><span class="n">afterAll</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
        <span class="n">closeDatabase</span><span class="p">()</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be false&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>In the example above, the <code>closeDatabase</code> hook ensures that the database connection is closed. after all test cases finish.</p><h3 id="aftereach">afterEach<a class="headerlink" href="#aftereach" title="Permanent link">#</a></h3><p>The hook runs after every test case in the suite. This is often useful if you want to clean up some temporary state that is created by each test.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.expect&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">hooks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.hooks&quot;</span><span class="p">)</span>

<span class="c1">-- imaginative function to clean cache</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">clearCache</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="kr">for</span> <span class="n">i</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>
        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kr">end</span>
<span class="kr">end</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;afterAll hook&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">cacheTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">hooks</span><span class="p">.</span><span class="n">afterEach</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
        <span class="n">clearCache</span><span class="p">(</span><span class="n">cacheTable</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">cacheTable</span><span class="p">[</span><span class="o">#</span><span class="n">cacheTable</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;some data&quot;</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">cacheTable</span><span class="p">).</span><span class="n">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be false&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">cacheTable</span><span class="p">[</span><span class="o">#</span><span class="n">cacheTable</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;some data&quot;</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">cacheTable</span><span class="p">).</span><span class="n">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>In the example above, the <code>clearCache</code> hook ensures that cache is being cleaned before any test case starts.</p><h3 id="beforeall">beforeAll<a class="headerlink" href="#beforeall" title="Permanent link">#</a></h3><p>The hook runs once before any test case in the suite. This is often useful if there is need to set a global setup state that is shared across tests.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.expect&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">hooks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.hooks&quot;</span><span class="p">)</span>

<span class="c1">-- abstract log function</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">os.date</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot; &quot;</span> <span class="o">..</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;beforeAll hook&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">hooks</span><span class="p">.</span><span class="n">beforeAll</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
        <span class="n">log</span><span class="p">(</span><span class="s2">&quot;Start testing, this message will be printed once.&quot;</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>

    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be false&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><p>In the example above, the <code>beforeAll</code> hook ensures that logging happens only once before all tests start.</p><h3 id="beforeeach">beforeEach<a class="headerlink" href="#beforeeach" title="Permanent link">#</a></h3><p>The hook runs before every test case in the suite. This is often useful if you want to set some temporary state that is created by each test.</p><div class="codehilite"><pre><span></span><code><span class="kd">local</span> <span class="n">describe</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Suite&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">expect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.expect&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.Test&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">hooks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;laura.hooks&quot;</span><span class="p">)</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;beforeEach hook&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">spy</span> <span class="o">=</span> <span class="n">Spy</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
    <span class="n">hooks</span><span class="p">.</span><span class="n">beforeEach</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
        <span class="n">spy</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hook is funning&quot;</span><span class="p">)</span>
        <span class="kr">end</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be true&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should be false&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">4</span><span class="p">).</span><span class="n">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
    <span class="n">it</span><span class="p">(</span><span class="s2">&quot;should call spy 3 times&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">spy</span><span class="p">).</span><span class="n">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div><h2 id="code-coverage">Code coverage<a class="headerlink" href="#code-coverage" title="Permanent link">#</a></h2><p>Laura supports code coverage. and may report in different ways: like a text, HTML file, CSV file, and other formats. To enable code coverage, there are several ways:</p><ol><li>Set up <code>Coverage.Enabled = true</code> in the <code>.laurarc</code> file in the project directory.</li><li>Set up <code>Coverage.Enabled = true</code> in the custom config file, which is passed in CLI with <code>-c</code> flag.</li><li>With the command line argument <code>--coverage</code> when using CLI.</li></ol><p><code>Coverage.Threshold</code> sets the coverage common percentage threshold, if coverage not met program exits with code <code>3</code>.</p><h3 id="inline-disable-coverage">Inline disable coverage<a class="headerlink" href="#inline-disable-coverage" title="Permanent link">#</a></h3><p>Source lines can be explicitly ignored using <code>enable</code> and <code>disable</code> inline options. An inline option is a simple comment: <code>-- coverage: enable</code> or <code>-- coverage: disable</code>. Inline option parsing is not whitespace sensitive. All lines starting from a line containing <code>disable</code> option and up to a line containing <code>enable</code> option (or end of file) are excluded.</p><p>To provide compatibility with <a href="https://github.com/lunarmodules/luacov">luacov</a>, options <code>-- coverage: enable | disabled</code>and <code>-- luacov: enable | disable</code> both are valid.</p><h2 id="exit-codes">Exit codes<a class="headerlink" href="#exit-codes" title="Permanent link">#</a></h2><p>When the test run is finished, there are exit codes:</p><ul><li><code>0</code> everything is successful; tests and coverage are passed;</li><li><code>1</code> Lua program error, link syntax error, or file access error;</li><li><code>2</code> there are failed tests;</li><li><code>3</code> coverage threshold is not met.</li></ul><h2 id="running-in-docker-container">Running in Docker container<a class="headerlink" href="#running-in-docker-container" title="Permanent link">#</a></h2><p>Building an image:</p><div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>&lt;your-image-name&gt;<span class="w"> </span>.
</code></pre></div><p>Run the container; notice that by default <code>/app</code> is the working directory; change it <code>Dockerfile</code> if you want to place your code in another directory.</p><div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/app<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>&lt;your-image-name&gt;
</code></pre></div><h2 id="testing-with-github-actions">Testing with GitHub actions<a class="headerlink" href="#testing-with-github-actions" title="Permanent link">#</a></h2><p>Laura is extremely easy to set up with multiple Lua versions. Check out <a href="https://github.com/dknight/laura-actions-demo/">working deno</a> on GitHub; or read the <a href="/post/testing-multiple-lua-versions-with-laura-and-github-actions.html">post about</a> this approach.</p><h2 id="who-is-laura-and-how-to-meet-her">Who is Laura? And how to meet her?<a class="headerlink" href="#who-is-laura-and-how-to-meet-her" title="Permanent link">#</a></h2><p>Initially, the project name was <em>&ldquo;aura&rdquo;</em>, while most of the packages in Lua ecosystem are prefixed with <em>&ldquo;L&rdquo;</em>, aura just became <em>&ldquo;Laura&rdquo;</em>. There is no any real girl with the name Laura who is associated with this framework.</p><p><a href="https://github.com/dknight/laura/">Source code on GitHub</a></p><h2 id="credits">Credits<a class="headerlink" href="#credits" title="Permanent link">#</a></h2><p>Original picture by <a href="https://lumeish.itch.io/">lumeish</a>, used under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution v4.0 International</a> license.</p><p>Coverage line scanner is modified algorithm based on <a href="https://github.com/lunarmodules/luacov">luacov</a>, published under <a href="https://opensource.org/license/MIT">MIT</a> license.</p><h2 id="contribution">Contribution<a class="headerlink" href="#contribution" title="Permanent link">#</a></h2><p>Any help is appreciated. Found a bug, typo, inaccuracy, etc.? Please do not hesitate to create <a href="https://github.com/dknight/laura/pulls">a pull request</a> or submit an <a href="https://github.com/dknight/laura/issues">issue</a>.</p><h2>Feedback</h2><p>For feedback, please check the <a href="/me/">contacts</a> section. Before writing, please specify where you came from and who you are. Sometimes spammers go insane. Thank you in advance for your understanding.</p></article><a href="/">&larr; Back to the index page</a></main><footer><hr><p>(c) 2022-2025 <a href="/me/">xdknight</a> Powered by <a href="https://github.com/hmngwy/jenny">Jenny</a> shell blog engine.</p><p>Any images on this website may be used, copied and redistributed under the <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license.</p><p>Any code on this website may be used, copied and redistributed under the <a href="https://opensource.org/license/MIT">MIT</a> license.</p><p>This website does not use cookies or any tracking techniques either. Also, this page is fully accessible, responsive, and readable on any device without a single line of JavaScript.</p></footer></body></html>