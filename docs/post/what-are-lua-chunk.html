<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Understanding chunks in Lua: local and global variable scope, loading, and execution chunks independently from the host program. " name=description><meta content="lua, programming, algorithms, data-structures, gamedev, game development, blog, personal" name=keywords><meta content="Dmitri Smirnov" name=author><meta content=website property=og:type><meta content=https://www.whoop.ee/post/what-are-lua-chunk.html property=og:url><meta content=https://www.whoop.ee/assets/img/whoopee-logo-black.png property=og:image><meta content="script-src 'self'" http-equiv=Content-Security-Policy><meta content="object-src 'none'" http-equiv=Content-Security-Policy><title>What are chunks in Lua? — Whoopee</title><link as=font href=/assets/fonts/Perfect_DOS_VGA_437.woff2 rel=preload><link href=/favicon.ico rel=icon type=image/x-icon><link href=/assets/css/styles.min.css rel=stylesheet><link title="RSS Feed" href=/feed.xml rel=alternate type=application/rss+xml><link href=https://www.whoop.ee/post/what-are-lua-chunk.html rel=canonical><body><header><a href=/><img alt=Whoopee class=logo height=172 src=/assets/img/whoopee-logo.png width=200></a><nav class=mainmenu><a href=/me/>About</a><a href=/feed.xml>RSS</a></nav></header><main><a href=/>← Back to the index page</a><article><h1>What are chunks in Lua?</h1><time datetime=2024-11-06> November 06, 2024 </time><p><strong>Chunk</strong> is an independent compilation unit in Lua. In other words, chunk is an independently executable sequence of statements.<p>A chunk can be stored in a file or as a string within the host program. When executing a chunk, Lua first loads it and precompiles the code into virtual machine instructions (bytecode). Lua then interprets and runs this compiled code on the virtual machine.<h2 id=code-example>Code example<a title="Permanent link" class=headerlink href=#code-example>#</a></h2><p>A common sequence of statements, here variables <code>x</code> and <code>y</code> have been declared without <code>local</code> keyword, so these are in the global scope.<div class=codehilite><pre><span></span><code><span class=n>x</span> <span class=o>=</span> <span class=mi>1</span>              <span class=c1>-- assignment statement</span>
<span class=n>y</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>10</span>         <span class=c1>-- assignment statement</span>
<span class=kr>if</span> <span class=n>x</span> <span class=o><</span> <span class=n>y</span> <span class=kr>then</span>      <span class=c1>-- if-else statement</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>"OK"</span><span class=p>)</span>      <span class=c1>-- function call statement</span>
<span class=kr>else</span>               <span class=c1>-- if-else statement</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>"NOK"</span><span class=p>)</span>     <span class=c1>-- function call statement </span>
<span class=kr>end</span>                <span class=c1>-- if-else statement</span>
</code></pre></div><p><code>do-end</code> block can be considered a chunk because it has its own scope. Variables declared as local <code>x</code> and <code>y</code>, thus both are in the chunks scope.<div class=codehilite><pre><span></span><code><span class=kr>do</span>                        <span class=c1>-- do-end statement</span>
    <span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>10</span>        <span class=c1>-- assignment statement</span>
    <span class=kd>local</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>1</span>             <span class=c1>-- assignment statement</span>
    <span class=kr>if</span> <span class=n>x</span> <span class=o><</span> <span class=n>y</span> <span class=kr>then</span>           <span class=c1>-- if-else statement</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>"OK in chunk"</span><span class=p>)</span>  <span class=c1>-- function call statement</span>
    <span class=kr>else</span>                    <span class=c1>-- if-else statement</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>"NOK in chunk"</span><span class=p>)</span> <span class=c1>-- function call statement </span>
    <span class=kr>end</span>                     <span class=c1>-- if-else statement</span>
<span class=kr>end</span>                       <span class=c1>-- end of do-end statement</span>
</code></pre></div><p>Combining two code snippets from above into one file. After execution of the program expected output will be:<div class=codehilite><pre><span></span><code><span class=s2>"OK"</span>           <span class=c1>-- x < y = 1 < 1024 (x and y have global scope)</span>
<span class=s2>"NOK in chunk"</span> <span class=c1>-- x < y = 1024 < 1 (x and y have chunk scope)</span>
</code></pre></div><p>Functions in Lua are also chunks. Variable <code>x</code> in the scope of <code>addNumbers</code> function.<div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>10</span>
<span class=kr>function</span> <span class=nf>addNumbers</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
  <span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
  <span class=kr>return</span> <span class=n>x</span>
<span class=kr>end</span>

<span class=n>addNumbers</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span> <span class=c1>--> 42</span>
<span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>           <span class=c1>--> 10</span>
</code></pre></div><h2 id=loading-chunks>Loading chunks<a title="Permanent link" class=headerlink href=#loading-chunks>#</a></h2><p>Built-in functions <code>load</code>, ‘loadfile’, and <code>dofile</code> load or execute Lua code as chunk.<p>Consider:<div class=codehilite><pre><span></span><code><span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>100</span>
<span class=kd>local</span> <span class=n>someChunk</span> <span class=o>=</span> <span class=s>[[</span>
<span class=s>    local x = 25</span>
<span class=s>    print(x)</span>
<span class=s>]]</span>

<span class=kd>local</span> <span class=n>chunk</span><span class=p>,</span> <span class=n>err</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=n>someChunk</span><span class=p>,</span> <span class=s2>"example"</span><span class=p>,</span> <span class=s2>"t"</span><span class=p>)</span>
<span class=kr>if</span> <span class=n>chunk</span> <span class=o>~=</span> <span class=kc>nil</span> <span class=kr>then</span>
    <span class=n>chunk</span><span class=p>()</span>
<span class=kr>else</span>
<span class=n>S</span>   <span class=nb>error</span><span class=p>(</span><span class=n>err</span><span class=p>)</span>
<span class=kr>end</span>
<span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>

<span class=c1>-- Output:</span>
<span class=c1>-- 25</span>
<span class=c1>-- 100</span>
</code></pre></div><p>After this example should be very clear, that <code>x</code> inside a chunk (chunk is a string <code>someChunk</code>) and <code>x</code> in the beginning of the snippet above are different variables in different scopes, despite the variable having the same name. So chunks have their own scope and are executed or compiled completely. independently, with own scope. Only the global variable <code>_ENV</code> shares the global scope between whole program. <code>_ENV</code> is available in all chunks of the program.<div class="admonition tip"><p class=admonition-title>Tip<p>It is a bad practice to change anything in the global variable <code>_ENV</code> and change it. This might lead to unexpected results and hardly detectable bugs.</div><p>Similar functions <code>loadfile</code> and <code>dofile</code> work in very similar way. Refer to the <a href=https://www.lua.org/manual/5.4/manual.html#pdf-load>Lua Manual</a> for detailed documentation.<h2 id=precompiled-chunks>Precompiled chunks<a title="Permanent link" class=headerlink href=#precompiled-chunks>#</a></h2><p>Chunks can be pre-compiled with the <code>luac</code> utility or <code>string.dump</code> function. Usually pre-compiled code loads faster because Lua skips the compilation step. Here comes a fair question. “Why not always use pre-compiled code?” Because compiled binary bytecode is platform dependent. This means that, compiled code on GNU Linux might not work in Microsoft Windows operating system.<h2 id=chunks-and-lua-command-line-client-cli>Chunks and Lua Command Line Client (CLI)<a title="Permanent link" class=headerlink href=#chunks-and-lua-command-line-client-cli>#</a></h2><p>When using the CLI by running the command <code>lua</code> which opens the command-line interface. Every line entered was explicitly interpreted as a separate <em>chunk</em>. To enter more statements, use the <code>do-end</code> statement.<p>Consider:<div class=codehilite><pre><span></span><code>lua
Lua 5.4.7  Copyright (C) 1994-2024 Lua.org, PUC-Rio
> local x = 10    -- chunk, x has scoped in the chunk
> print(x)
nil               -- x is nil because it is out of scope
> do              -- start do-end statement
>> local x = 10   -- x is scoped in the chunk
>> print(x)
>> end            -- end of do-end statement
10
> 
</code></pre></div><h2 id=references>References<a title="Permanent link" class=headerlink href=#references>#</a></h2><ul><li><a href=https://www.lua.org/manual/5.4/manual.html#3.3.2>Lua Manual: Chunks</a></ul><h2>Feedback</h2><p>For feedback, please check the <a href=/me/>contacts</a> section. Before writing, please specify where you came from and who you are. Sometimes spammers go insane. Thank you in advance for your understanding.</article><a href=/>← Back to the index page</a></main><footer><hr><p>(c) 2022-2025 <a href=/me/>xdknight</a> Powered by <a href=https://github.com/hmngwy/jenny>Jenny</a> shell blog engine.<p>Any images on this website may be used, copied and redistributed under the <a href=https://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a> license.<p>Any code on this website may be used, copied and redistributed under the <a href=https://opensource.org/license/MIT>MIT</a> license.<p>This website does not use cookies or any tracking techniques either. Also, this page is fully accessible, responsive, and readable on any device without a single line of JavaScript.</footer>